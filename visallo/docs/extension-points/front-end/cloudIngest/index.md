# Ingest from Cloud

* [Ingest Cloud JavaScript API `org.visallo.ingest.cloud`](../../../javascript/org.visallo.ingest.cloud.html)
* [Ingest Cloud Example Code](https://github.com/visallo/doc-examples/tree/master/extension-ingest-cloud)

<div style="text-align:center">
<img src="./cloud-import.png" width="100%" style="max-width: 275px;">
</div>

Create custom endpoints to ingest content into Visallo. A long-running process will process the loading of content asynchronously. Plugins must register a [`CloudResourceSource`](https://github.com/visallo/visallo/blob/master/core/core/src/main/java/org/visallo/core/ingest/cloud/CloudResourceSource.java) service that returns a `CloudResourceItem` (or multiple) given a JSON configuration object generated by a custom component in the UI.

Cloud import items are available in the file import popover.

## Tutorial

For this tutorial we'll build a new URL cloud ingest plugin. The user will supply a URL (to a document, image, etc.) to import into Visallo.

<div style="text-align:center">
<img src="./selectIngest.png" width="100%" style="max-width: 260px;">
<img src="./urlIngest.png" width="100%" style="max-width: 260px;">
<img src="./activity.png" width="100%" style="max-width: 260px;">
</div>

### Web Plugin Resources

Register the plugin and configuration component, along with a message bundle.

{% github_embed "https://github.com/visallo/doc-examples/blob/6b2e6f64/extension-ingest-cloud/src/main/java/org/visallo/examples/ingest_cloud/IngestCloudWebAppPlugin.java#L16-L22" %}{% endgithub_embed %}

### Register Extension

{% github_embed "https://github.com/visallo/doc-examples/blob/6b2e6f64/extension-ingest-cloud/src/main/resources/org/visallo/examples/ingest_cloud/plugin.js#L1-L8" %}{% endgithub_embed %}


### React Configuration Component

Now, create the React component interface to specify a URL to ingest.

{% github_embed "https://github.com/visallo/doc-examples/blob/6b2e6f64/extension-ingest-cloud/src/main/resources/org/visallo/examples/ingest_cloud/UrlConfig.jsx#L6" %}{% endgithub_embed %}

Call the `onImport` when the user clicks import.

{% github_embed "https://github.com/visallo/doc-examples/blob/6b2e6f64/extension-ingest-cloud/src/main/resources/org/visallo/examples/ingest_cloud/UrlConfig.jsx#L38-L41" %}{% endgithub_embed %}


### Create the `CloudResourceSource`

Create the Java class, and register as a service in `META-INF/services`. The full Java class should match the `identifier` defined in the extension.

{% github_embed "https://github.com/visallo/doc-examples/blob/6b2e6f64/extension-ingest-cloud/src/main/java/org/visallo/examples/ingest_cloud/UrlIngestCloudResourceSource.java#L15-L27" %}{% endgithub_embed %}

{% github_embed "https://github.com/visallo/doc-examples/blob/6b2e6f64/extension-ingest-cloud/src/main/resources/META-INF/services/org.visallo.core.ingest.cloud.CloudResourceSource#L1" %}{% endgithub_embed %}


### Message Bundle

The interface needs some message keys for the component, and an implicit `title` based on the `identifier`.

{% github_embed "https://github.com/visallo/doc-examples/blob/6b2e6f64/extension-ingest-cloud/src/main/resources/org/visallo/examples/ingest_cloud/messages.properties#L1-L3" %}{% endgithub_embed %}


## Flight Component Example

Legacy plugins written in Flight should trigger a `cloudImported` event with the configuration.

For example:

```js
this.trigger('cloudImported', { paths: [url] })
```
